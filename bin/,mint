#!/bin/bash

set -ex

rm -f ~/Downloads/transactions.csv

Xephyr :8 -screen 1024x768 -no-host-grab &
DISPLAY=:8

google-chrome --user-data-dir=$HOME/.config/mint-chromium &

# visit mint.intuit.com/transaction
# ctrl-f brandon ctrl?-enter ctrl-f continue ctrl-enter
# already at transaction page; maybe because I followed bookmark?
# ctrl-f export ctrl-enter, then wait some

#sleep 199999
sleep 3
xdotool key ctrl+t
sleep 1
xdotool type mint.com
xdotool key Return
read -t 8 -p "Sleeping 8 seconds waiting for the site" || true
echo
xdotool key ctrl+f type "sign in"
xdotool key ctrl+Return
read -t 10 -p "Sleeping 10 seconds waiting for login dialog" || true
echo
xdotool key ctrl+f type "Last accessed"
xdotool key ctrl+Return
read -t 10 -p "Sleeping 10 seconds waiting for password dialog" || true
xdotool key Return
read -t 12 -p "Sleeping 12 seconds waiting for login to complete" || true
echo
xdotool key ctrl+f type "transactions"
xdotool key ctrl+Return
if [ -n "$1" ]
then
    # support "-i" option to allow interactive use
    read -p "Press Enter when done interacting with transactions: "
else
    read -t 8 -p "Sleeping 8 seconds waiting for transactions page" || true
fi
xdotool key ctrl+f type "Export"
xdotool key ctrl+Return
read -t 8 -p "Sleeping 8 seconds waiting for CSV" || true
xdotool key ctrl+w
sleep 1
xdotool key ctrl+w
sleep 1
kill %1
